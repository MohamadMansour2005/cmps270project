#include <stdio.h>
#include <stdlib.h>

#define GRID_SIZE 10 // Define the size of the grid

// Struct to represent a player
typedef struct {
    char playerName[50];
    char cells[GRID_SIZE][GRID_SIZE]; // Grid for player
    char opponent_grid[GRID_SIZE][GRID_SIZE]; // Opponent's grid
    int ships_left; // Number of ships left
} Player;

// Function to initialize the grid with a specified character
void initializeGrid(char grid[GRID_SIZE][GRID_SIZE], char fillChar) {
    for (int i = 0; i < GRID_SIZE; i++) {
        for (int j = 0; j < GRID_SIZE; j++) {
            grid[i][j] = fillChar; // Fill each cell with water
        }
    }
}

// Function to display the grid
void displayGrid(const char grid[GRID_SIZE][GRID_SIZE]) {
    // Print column headers
    printf("  A B C D E F G H I J\n");
    
    // Print each row with its corresponding number
    for (int i = 0; i < GRID_SIZE; i++) {
        printf("%2d ", i + 1); // Row number with space for alignment
        for (int j = 0; j < GRID_SIZE; j++) {
            printf("%c ", grid[i][j]); // Print function for the grid
        }
        printf("\n"); // New line after each row
    }
}

// Function to get player names
void getPlayerNames(Player *player1, Player *player2) {
    printf("Enter name for Player 1: ");
    scanf("%s", player1->playerName);
    printf("Enter name for Player 2: ");
    scanf("%s", player2->playerName);
}

// Function to get difficulty level
int getDifficultyLevel() {
    int difficulty;
    printf("Select difficulty level (1 for Easy, 2 for Hard): ");
    scanf("%d", &difficulty);
    return difficulty;
}

void printGrid(Player *p) {
    displayGrid(p->cells);
}

int placeShipHelper(Player *p, int num_of_cells_for_ship) {
    char choice;
    printf("\nRemember your ship takes %d cells. Would you like to place your ship vertically (V) or horizontally (H)? ", num_of_cells_for_ship);
    scanf(" %c", &choice);
    printf("Please enter which cell you would like your ship to begin (e.g., A1): ");
    char cell[3];
    scanf("%s", cell);

    int row = cell[1] - '1'; // conversion from ASCII code
    int col = cell[0] - 'A';

    if (choice == 'V') {
        if (row + num_of_cells_for_ship > 9) {
            printf("Ship cannot fit!\n");
            return 0;
        } else {
            for (int i = 0; i < num_of_cells_for_ship; i++) {
                if(p->cells[row + i][col] == '#'){
                    printf("A ship already exists in one of these cells!\n");
                    return 0;
                }
            }
        }
        for (int i = 0; i < num_of_cells_for_ship; i++) {
            p->cells[row + i][col] = '#';
        }
    } else if (choice == 'H') {
        if (col + num_of_cells_for_ship > 9) {
            printf("Ship cannot fit!\n");
            return 0;
        } else {
            for (int i = 0; i < num_of_cells_for_ship; i++) {
                if(p->cells[row][col + i] == '#'){
                    printf("A ship already exists in one of these cells!\n");
                    return 0;
                }
            }
        }
        for (int i = 0; i < num_of_cells_for_ship; i++) {
            p->cells[row][col + i] = '#';
        }
    } else {
        printf("Invalid choice!\n");
        return 0;
    }
    printGrid(p);
    return 1;
}

void placeShip(Player *p){
    printf("Let's start filling the ships! %s\n", p->playerName);

    int is_carrier_placed = 0;
    while(is_carrier_placed == 0){
        is_carrier_placed = placeShipHelper(p, 5);
    }

    printf("\nLet's now place your battleship!\n");
    int is_battleship_placed = 0;
    while(is_battleship_placed == 0){
        is_battleship_placed = placeShipHelper(p, 4);
    }

    printf("\nLet's now place your destroyer!\n");
    int is_destroyer_placed = 0;
    while(is_destroyer_placed == 0){
        is_destroyer_placed = placeShipHelper(p, 3);
    }

    printf("\nLet's now place your submarine!\n");
    int is_submarine_placed = 0;
    while(is_submarine_placed == 0){
        is_submarine_placed = placeShipHelper(p, 2);
    }

    printGrid(p);
}

void fire(Player *attacker, Player *being_attacked) {
    char coordinates[3];
    printf("\nPlease enter coordinates of where you want to attack (e.g., A1): ");
    scanf("%s", coordinates);
    int row = coordinates[1] - '1';
    int col = coordinates[0] - 'A';

    if (being_attacked->cells[row][col] == '~') {
        attacker->opponent_grid[row][col] = 'o';
        printf("Miss!!\n");
    } else if (being_attacked->cells[row][col] == '#') {
        attacker->opponent_grid[row][col] = '*';
        printf("Hit!!\n");
        being_attacked->ships_left--; // Reduce the count of ships left
    } else {
        printf("You have already targeted this location.\n");
    }
}

int main() {
    Player p1, p2;

    // Initialize both players' grids with water
    char fillCharacter = '~'; // Define the character to fill the grid with
    initializeGrid(p1.cells, fillCharacter);
    initializeGrid(p2.cells, fillCharacter);
    initializeGrid(p1.opponent_grid, fillCharacter);
    initializeGrid(p2.opponent_grid, fillCharacter);

    // Get player names
    getPlayerNames(&p1, &p2);

    // Get difficulty level
    int difficulty = getDifficultyLevel();

    // Set initial ships left
    p1.ships_left = 4;
    p2.ships_left = 4;

    // Display both grids
    printf("\n%s's grid:\n", p1.playerName);
    displayGrid(p1.cells);
    
    printf("\n%s's grid:\n", p2.playerName);
    displayGrid(p2.cells);

    // Place ships for both players
    placeShip(&p1);
    placeShip(&p2);

    // Game loop
    while (p1.ships_left > 0 && p2.ships_left > 0) {
        printf("\n%s's turn:\n", p1.playerName);
        fire(&p1, &p2);
        if (p2.ships_left <= 0) {
            printf("%s wins!\n", p1.playerName);
            break;
        }

        printf("\n%s's turn:\n", p2.playerName);
        fire(&p2, &p1);
        if (p1.ships_left <= 0) {
            printf("%s wins!\n", p2.playerName);
            break;
        }
    }

    return 0; // Indicate successful completion
}
